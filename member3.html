<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ë¥˜ìˆ˜ì—° - V8 íŒ€ì›</title>
    <!-- jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: sans-serif;
      }
      /*ë©”ì¸ê³¼ ê¸€ê¼´ í†µì¼*/
      .header_section {
        background-color: #0f172a;
        padding: 2rem;
        text-align: center;
      }

      .header_name {
        font-size: 100px;
        font-weight: bold;
        color: #0f172a;
        text-decoration: none;
        float: left;
        margin-left: 100px;
        margin-top: 10px;
      }

      /* í™ˆí˜ì´ì§€ë¡œ ëŒì•„ê°€ëŠ” ë²„íŠ¼ */
      .header_home {
        font-size: 20px;
        font-weight: bold;
        color: white;
        text-decoration: none;
        float: right;
      }

      /*í—¤ë” ë°°ê²½, ê¸€ê¼´ ì§€ì •*/
      .comment-top {
        display: flex;
        justify-content: space-between;
        align-items: center;

        font-weight: bold;
        border-bottom: 1px solid #dee2e6;
        margin-bottom: 8px;
      }

      .comment {
        font-weight: bold;
      }

      .person_image {
        max-width: 100%;
        height: 100%;
        border-radius: 4px;
      }
      /*imgíŒŒì¼ í¬ê¸° ì¹´ë“œì— ë§ì¶¤*/
    </style>
    <script type="module">
      // Firebase
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import {
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBUuA-bppz3--8IMOryo1p7QgOBbMfgS6s",
        authDomain: "sparta-v8.firebaseapp.com",
        projectId: "sparta-v8",
        storageBucket: "sparta-v8.firebasestorage.app",
        messagingSenderId: "641530961251",
        appId: "1:641530961251:web:25b86f361fdae002f68756",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // ì—´ê³  ë‹«ê¸°
      $("#openclose").click(async function () {
        $("#commentbox").toggle();
        const btn = document.getElementById("openclose");
        const isVisible = $("#commentbox").is(":visible");
        btn.textContent = isVisible ? "ë‹«ê¸°" : "ëŒ“ê¸€ì‘ì„±í•˜ê¸°";
      });

      // ëŒ“ê¸€ DB ì €ì¥
      $("#makeComment").click(async function () {
        $("#alert").empty();
        let name = $("#name").val();
        let comment = $("#comment").val();

        if (!name || !comment) {
          let alert_html = `
            <div class="alert alert-danger" role="alert">
              ë‹¤ìŒ ì…ë ¥ì¹¸ë“¤ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”
            </div>`;

          $("#alert").append(alert_html);
          return;
        }

        let doc = {
          name: name,
          comment: comment,
          createdAt: Date.now(),
        };
        // ê°œì¸ë³„ ëŒ“ê¸€ DB
        await addDoc(collection(db, "comment3"), doc);
        alert("ì €ì¥ ì™„ë£Œ!");
        window.location.reload();
      });

      // ëŒ“ê¸€ DB ë¶ˆëŸ¬ì˜¤ê¸°
      let docs = await getDocs(collection(db, "comment3"));
      docs.forEach((doc) => {
        let row = doc.data();

        let name = row["name"];
        let comment = row["comment"];
        let createdAt = new Date(row["createdAt"]).toLocaleString();

        let temp_html = `
            <div class="border p-3 mb-2">
              <p class="mb-1" style="display: flex; justify-content: space-between;">
                <span><strong>ì´ë¦„:</strong> ${name}</span>
                <span style="color: gray; font-size: small;">${createdAt}</span>
              </p>
              <p class="mb-0"><strong>ë‚´ìš©:</strong> ${comment}</p>
            </div>`;

        $("#comment-area").append(temp_html);
      });
      let count_html = `<div>${docs.size}ê°œì˜ ëŒ“ê¸€</div>`;
      $("#count").append(count_html);
    </script>
  </head>

  <body class="bg-light">
    <header class="header_section">
      <a href="mainscreen.html" class="header_home">V8 í™ˆ</a>
      <a href="mainscreen.html" class="header_name">&laquo;</a>
    </header>

    <main class="container my-5">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="card shadow rounded-3">
            <div class="row g-0">
              <div class="col-md-4">
                <img
                  src="image/ë¥˜ìˆ˜ì—°.png"
                  class="person_image"
                  alt="ë¥˜ìˆ˜ì—° ì‚¬ì§„"
                />
              </div>
              <div class="col-md-8">
                <div class="card-body">
                  <h4 class="card-title fw-bold">ë¥˜ìˆ˜ì—°</h4>
                  <span class="badge text-bg-success">íŒ€ì›</span>
                  <p class="card-text">
                    ë‹¤ë“¤ í™”ì´íŒ…í•´ì„œ ì¢‹ì€ ê²°ê³¼ ì–»ì–´ê°”ìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤!
                  </p>
                  <ul class="list-unstyled">
                    <li><strong>ìƒì¼:</strong> 2001.05.19</li>
                    <li><strong>MBTI:</strong> ISTJ</li>
                    <li>
                      <strong>ë¸”ë¡œê·¸ ì£¼ì†Œ:</strong>
                      <a href="https://velog.io/@rsy7567" target="_blank"
                        >https://velog.io/@rsy7567</a
                      >
                    </li>
                    <li><strong>TMI:</strong> ìƒì‹œ ì»´í“¨í„° í‚¤ëŠ” ì¤‘...ğŸ’»</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- ëŒ“ê¸€ ì„¹ì…˜ -->
          <section class="mt-5">
            <div class="comment-top">
              <h5 class="comment">ëŒ“ê¸€</h5>
              <div id="count"></div>
            </div>
            <button class="btn btn-outline-primary mb-4" id="openclose">
              ëŒ“ê¸€ì‘ì„±í•˜ê¸°
            </button>
            <div id="commentbox" style="display: none">
              <div id="alert"></div>
              <div class="mb-3">
                <label for="commentName" class="name">ì´ë¦„</label>
                <input
                  type="text"
                  class="form-control"
                  id="name"
                  placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
                />
              </div>
              <div class="mb-3">
                <label for="commentContent" class="content">ë‚´ìš©</label>
                <textarea
                  class="form-control"
                  id="comment"
                  rows="3"
                  placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
                ></textarea>
              </div>
              <button class="btn btn-outline-primary mb-4" id="makeComment">
                ëŒ“ê¸€ì‘ì„±
              </button>
            </div>

            <div id="comment-area"></div>
          </section>
        </div>
      </div>
    </main>
  </body>
</html>
